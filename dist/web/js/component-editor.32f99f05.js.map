{"version":3,"file":"js/component-editor.32f99f05.js","mappings":"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","sources":["webpack://online-conplier/./src/views/editor/Editor.vue","webpack://online-conplier/./src/views/editor/testSFC.js","webpack://online-conplier/./src/views/editor/Editor.vue?d869"],"sourcesContent":["<template>\r\n  <PageContainer\r\n    :content=\"content\"\r\n    :extraContent=\"extractContent\"\r\n  >\r\n    <div class=\"container\">\r\n      <div class=\"editor-wrap\">\r\n        <codemirror\r\n          v-model=\"formState.code\"\r\n          placeholder=\"Code goes here...\"\r\n          :style=\"{ height: 'calc(100vh - 200px)' }\"\r\n          :autofocus=\"true\"\r\n          :indent-with-tab=\"true\"\r\n          :tab-size=\"2\"\r\n          :extensions=\"extensions\"\r\n        />\r\n      </div>\r\n      <div class=\"preview-container\">\r\n        <div class=\"preview-wrap\">\r\n          <iframe\r\n            src=\"/#/preview\"\r\n            frameborder=\"0\"\r\n            style=\"height: 70vh;width: 100%;\"\r\n            id=\"preview-iframe\"\r\n            sandbox=\"allow-same-origin allow-forms allow-scripts allow-top-navigation-to-custom-protocols allow-top-navigation-by-user-activation allow-top-navigation\"\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <Drawer\r\n      v-model:visible=\"visible\"\r\n      title=\"属性定义\"\r\n      placement=\"right\"\r\n    >\r\n      <p>todo</p>\r\n    </Drawer>\r\n  </PageContainer>\r\n</template>\r\n\r\n<script>\r\n  import { onMounted, reactive, ref } from 'vue'\r\n  import { useRoute } from 'vue-router'\r\n  import { Button, Form, Input, message, Drawer } from 'ant-design-vue'\r\n  import { PageContainer } from '@ant-design-vue/pro-layout'\r\n  import { Codemirror } from 'vue-codemirror'\r\n  import { javascript } from '@codemirror/lang-javascript'\r\n  import { oneDark } from '@codemirror/theme-one-dark'\r\n  import { keymap } from \"@codemirror/view\"\r\n  import { parser } from '../../utils/parser'\r\n  import { tp0 } from './testSFC'\r\n  import { saveComponent, getComponet } from '../../service/compoment'\r\n\r\n  export default {\r\n    name: 'x-editor',\r\n    components: {\r\n      Codemirror,\r\n      Drawer\r\n    },\r\n    setup() {\r\n      const route = useRoute()\r\n      const fromRef = ref(null)\r\n      const formState = reactive({\r\n        id: +route.params.id,\r\n        name: '',\r\n        key: '',\r\n        code: tp0,\r\n      })\r\n      const formRule = reactive({\r\n        name: [{ required: true, message: '请输入组件名称' }],\r\n        key: [{ required: true, message: '请输入组件key' }],\r\n        code: [{ required: true, message: '请输入代码' }],\r\n      })\r\n\r\n      const iframeRef = ref('')\r\n      const visible = ref(false)\r\n      // const previewWindow = ref('')\r\n      const onPreview = async () => {\r\n        try {\r\n        const res = await parser(formState.code)\r\n        // previewWindow.value.postMessage({ type: 'editore2preview', data: res }, '*')\r\n        iframeRef.value.contentWindow.postMessage({ type: 'editore2preview', data: res }, '*')\r\n        } catch(e) {\r\n          console.log(e)\r\n        }\r\n      }\r\n      const extensions = [\r\n        javascript(), \r\n        oneDark,\r\n        keymap.of([{\r\n          key: \"Ctrl-s\",\r\n          run() { \r\n            onPreview()\r\n            return true\r\n          }\r\n        }])\r\n      ]\r\n      const onMessage = (e) => {\r\n      const { data: { type, key } } = e\r\n      if (type == 'preview2editor') {\r\n        console.log(type, key)\r\n        if (key === 'mounted') {\r\n          if (iframeRef.value) {\r\n            onPreview()\r\n          }\r\n        }\r\n      }\r\n    }\r\n      onMounted(() => {\r\n        window.addEventListener('message', onMessage)\r\n        // if (!previewWindow.value) {\r\n        //   previewWindow.value = window.open('http://localhost:8082/')\r\n        // }\r\n        iframeRef.value = document.getElementById('preview-iframe')\r\n        iframeRef.value.onload = function () {\r\n          onPreview()\r\n        }\r\n      })\r\n      const onSubmit = async () => {\r\n        await fromRef.value.validate()\r\n        if (!formState.code) {\r\n          message.error({ content: '请输入组件代码', duration: 3 })\r\n          return\r\n        }\r\n        let parseRes = {}\r\n        try {\r\n          parseRes = await parser(formState.code)\r\n        } catch (e) {\r\n          console.error(e)\r\n          message.error({ content:  '编译出错啦，请预览成功再保存', duration: 3 })\r\n          return\r\n        }\r\n        const result = {\r\n          type: '2',\r\n          name: formState.name,\r\n          key: formState.key,\r\n          code: formState.code,\r\n          script: parseRes,\r\n        }\r\n        if (formState.id) {\r\n          result.id = +formState.id\r\n        }\r\n        try {\r\n          const id = await saveComponent(result)\r\n          formState.id = id\r\n        } catch (e) {\r\n          console.error(e)\r\n          message.error({ content: e })\r\n          return\r\n        }\r\n        message.success({ content: '保存成功', duration: 3 })\r\n      }\r\n      const content = () => (\r\n        <>\r\n          <Form layout=\"inline\" rules={formRule} ref={fromRef} model={formState} hideRequiredMark >\r\n            <Form.Item label=\"组件名称\" name=\"name\">\r\n              <Input v-model:value={formState.name} />\r\n            </Form.Item>\r\n            <Form.Item label=\"组件key\" name=\"key\">\r\n              <Input v-model:value={formState.key} disabled={!!formState.id}/>\r\n            </Form.Item>\r\n            <Form.Item>\r\n              <Button type=\"primary\" ghost onClick={() => visible.value = true}>属性定义</Button>\r\n            </Form.Item>\r\n          </Form>\r\n        </>\r\n      )\r\n\r\n      const extractContent = () => <Button type=\"primary\" onClick={onSubmit}>保存</Button>\r\n\r\n      onMounted(() => {\r\n        if (route.params.id) {\r\n          console.log(route.params.id)\r\n          getComponet(route.params.id).then(res => {\r\n            if (res) {\r\n              formState.name = res.name\r\n              formState.key = res.key\r\n              formState.code = res.code\r\n            }\r\n          })\r\n        }\r\n      })\r\n      return {\r\n        formState,\r\n        extensions,\r\n        iframeRef,\r\n        onPreview,\r\n        Button,\r\n        PageContainer,\r\n        content,\r\n        visible,\r\n        extractContent\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"stylus\">\r\n.container\r\n  display flex\r\n  & /deep/ .cm-scroller:-webkit-scrollbar\r\n    width 0 !important\r\n  .editor-wrap\r\n    flex 1\r\n  .preview-container\r\n    flex-shrink 0\r\n    padding 16px\r\n    width 407px\r\n    background-color #fff\r\n    .preview-wrap\r\n      border-radius 10px\r\n      height: 70vh\r\n      border: 1px solid #eee\r\n    #preview-iframe\r\n      border-radius: 10px\r\n    #preview-iframe::-webkit-scrollbar\r\n      width 0\r\n    #preview-iframe html::-webkit-scrollbar\r\n      width 0\r\n    #preview-iframe body::-webkit-scrollbar\r\n      width 0\r\n</style>","export const tp0 = `\r\n<template>\r\n  <div class=\"blue\">{{date}}</div>\r\n  <div>{{msg}}</div>\r\n</template>\r\n<script setup>\r\n  import { ref } from 'vue'\r\n  import dayjs from 'https://unpkg.com/dayjs@1.11.5/esm/index.js'\r\n  const date = dayjs().format('YYYY-MM-DD HH:mm:ss')\r\n  const msg = ref('编辑完成后，Ctrl + s 即可预览')\r\n</script>\r\n<style lang=\"styl\" scoped>\r\n.blue\r\n  color blue\r\n</style>\r\n`;\r\n\r\nexport const tp1 = `\r\n<template>\r\n  <div>\r\n  <div class=\"blue\">hello word</div>\r\n  <input v-model=\"val\" />\r\n  </div>\r\n</template>\r\n<script>\r\nexport default defineComponent({\r\n  setup () {\r\n    const val = ref('')\r\n    onMounted(() => {\r\n      console.log('onMounted')\r\n    })\r\n    watchEffect(() => {\r\n      console.log(val.value)\r\n    })\r\n    return { val }\r\n    // return () => (<input v-model={val.value} />)\r\n  }\r\n})\r\n</script>\r\n`\r\n\r\nexport const tp2 = `\r\n<template>\r\n  <div>\r\n    <div class=\"blue\">hello word</div>\r\n    <input v-model=\"val\" />\r\n  </div>\r\n</template>\r\n<script>\r\nexport default defineComponent({\r\n  data () {\r\n    return {\r\n      val: ''\r\n    }\r\n  },\r\n  watch: {\r\n    val (val) {\r\n      console.log(val)\r\n    }\r\n  },\r\n  mounted () {\r\n    console.log('imoport')\r\n    console.log('onMounted')\r\n  }\r\n})\r\n</script>\r\n<style lang=\"stylus\" scoped>\r\n.blue {\r\n  color: blue;\r\n}\r\n</style>\r\n`;\r\n\r\nexport const tp3 = `\r\n<script>\r\nexport default defineComponent({\r\n  data () {\r\n      return {\r\n        list: [],\r\n        loading: false,\r\n        finished: false,\r\n        refreshing: false,\r\n      }\r\n  },\r\n  methods: {\r\n    onLoad() {\r\n      if (this.timer) return;\r\n      this.loading = true\r\n      this.timer = setTimeout(() => {\r\n        for (let i = 0; i < 20; i++) {\r\n          this.list.push(this.list.length + 1);\r\n        }\r\n        this.loading = false;\r\n        this.refreshing = false\r\n        if (this.list.length >= 80) {\r\n          this.finished = true;\r\n        }\r\n        this.timer = null\r\n      }, 2000);\r\n    },\r\n    onRefresh() {\r\n      this.refreshing = true\r\n      this.list = []\r\n      this.finished = false;\r\n      this.onLoad();\r\n    },\r\n    onRowClick (e) {\r\n      console.log(e)\r\n    }\r\n  },\r\n  render () {\r\n      return (\r\n        <van-pull-refresh v-model={this.refreshing} onRefresh={this.onRefresh}>\r\n          <van-list\r\n            v-model:loading={this.loading}\r\n            finished={this.finished}\r\n            finished-text=\"没有更多了\"\r\n            loading-text=\"正在加载\"\r\n            onLoad={this.onLoad}\r\n          >\r\n            {this.list.map((item) => (\r\n              <van-cell\r\n                key={item}\r\n                title={item}\r\n                onClick={() => this.onRowClick(item)} \r\n              />\r\n            ))}\r\n          </van-list>\r\n        </van-pull-refresh>\r\n      )\r\n  }\r\n})\r\n</script>\r\n<style lang=\"styl\">\r\n.van-cell__title\r\n  color red\r\n  text-align center\r\n</style>\r\n`","import { render } from \"./Editor.vue?vue&type=template&id=61a7b820\"\nimport script from \"./Editor.vue?vue&type=script&lang=js\"\nexport * from \"./Editor.vue?vue&type=script&lang=js\"\n\nimport \"./Editor.vue?vue&type=style&index=0&id=61a7b820&lang=stylus\"\n\nimport exportComponent from \"D:\\\\Code\\\\vue-onlie-editor\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["class","_createElementVNode","src","frameborder","style","id","sandbox","_createBlock","_component_PageContainer","content","$setup","extraContent","_createVNode","_component_codemirror","code","$event","placeholder","height","autofocus","extensions","_hoisted_3","_component_Drawer","visible","title","placement","_hoisted_4","tp0","name","components","Codemirror","Drawer","setup","route","useRoute","fromRef","ref","formState","reactive","params","key","formRule","required","message","iframeRef","onPreview","async","res","parser","value","contentWindow","postMessage","type","data","e","console","log","javascript","oneDark","keymap","run","onMessage","onMounted","window","addEventListener","document","getElementById","onload","onSubmit","validate","duration","parseRes","error","result","script","saveComponent","extractContent","getComponet","then","Button","PageContainer","__exports__","render"],"sourceRoot":""}