"use strict";(self["webpackChunkonline_conplier"]=self["webpackChunkonline_conplier"]||[]).push([[443],{28857:function(e,t,o){o.r(t),o.d(t,{default:function(){return P}});var n=o(10311);const a={class:"container"},r={class:"editor-wrap"},i=(0,n.createElementVNode)("div",{class:"preview-container"},[(0,n.createElementVNode)("div",{class:"preview-wrap"},[(0,n.createElementVNode)("iframe",{src:"/#/preview",frameborder:"0",style:{height:"70vh",width:"100%"},id:"preview-iframe",sandbox:"allow-same-origin allow-forms allow-scripts allow-top-navigation-to-custom-protocols allow-top-navigation-by-user-activation allow-top-navigation"})])],-1),l=(0,n.createElementVNode)("p",null,"todo",-1);function d(e,t,o,d,s,c){const m=(0,n.resolveComponent)("codemirror"),u=(0,n.resolveComponent)("Drawer"),p=(0,n.resolveComponent)("PageContainer");return(0,n.openBlock)(),(0,n.createBlock)(p,{content:d.content,extraContent:d.extractContent},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",a,[(0,n.createElementVNode)("div",r,[(0,n.createVNode)(m,{modelValue:d.formState.code,"onUpdate:modelValue":t[0]||(t[0]=e=>d.formState.code=e),placeholder:"Code goes here...",style:(0,n.normalizeStyle)({height:"calc(100vh - 200px)"}),autofocus:!0,"indent-with-tab":!0,"tab-size":2,extensions:d.extensions},null,8,["modelValue","style","extensions"])]),i]),(0,n.createVNode)(u,{visible:d.visible,"onUpdate:visible":t[1]||(t[1]=e=>d.visible=e),title:"属性定义",placement:"right"},{default:(0,n.withCtx)((()=>[l])),_:1},8,["visible"])])),_:1},8,["content","extraContent"])}o(24535);var s=o(74246),c=(o(6566),o(99332)),m=(o(24348),o(68626)),u=(o(1350),o(10252)),p=(o(4802),o(243)),v=o(22483),y=o(28934),f=o(56159),w=o(23011),g=o(5406),k=o(71901),h=o(24887);const C="\n<template>\n  <div class=\"blue\">{{date}}</div>\n  <div>{{msg}}</div>\n</template>\n<script setup>\n  import { ref } from 'vue'\n  import dayjs from 'https://unpkg.com/dayjs@1.11.5/esm/index.js'\n  const date = dayjs().format('YYYY-MM-DD HH:mm:ss')\n  const msg = ref('编辑完成后，Ctrl + s 即可预览')\n<\/script>\n<style lang=\"styl\" scoped>\n.blue\n  color blue\n</style>\n";var V=o(29583),b=o(15941),N={name:"x-editor",components:{Codemirror:f.Z1,Drawer:p.Z},setup(){const e=(0,v.yj)(),t=(0,n.ref)(null),o=(0,n.reactive)({id:+e.params.id,name:"",key:"",code:C}),a=(0,n.reactive)({name:[{required:!0,message:"请输入组件名称"}],key:[{required:!0,message:"请输入组件key"}],code:[{required:!0,message:"请输入代码"}]}),r=(0,n.ref)(""),i=(0,n.ref)(!1),l=async()=>{try{const e=await(0,h.parser)(o.code);r.value.contentWindow.postMessage({type:"editore2preview",data:e},"*")}catch(e){b.log(e)}},d=[(0,w.eJ)(),g.vk,k.$f.of([{key:"Ctrl-s",run(){return l(),!0}}])],p=e=>{const{data:{type:t,key:o}}=e;"preview2editor"==t&&(b.log(t,o),"mounted"===o&&r.value&&l())};(0,n.onMounted)((()=>{window.addEventListener("message",p),r.value=document.getElementById("preview-iframe"),r.value.onload=function(){l()}}));const f=async()=>{if(await t.value.validate(),!o.code)return void u.ZP.error({content:"请输入组件代码",duration:3});let e={};try{e=await(0,h.parser)(o.code)}catch(a){return b.error(a),void u.ZP.error({content:"编译出错啦，请预览成功再保存",duration:3})}const n={type:"2",name:o.name,key:o.key,code:o.code,script:e};o.id&&(n.id=+o.id);try{const e=await(0,V.saveComponent)(n);o.id=e}catch(a){return b.error(a),void u.ZP.error({content:a})}u.ZP.success({content:"保存成功",duration:3})},N=()=>(0,n.createVNode)(n.Fragment,null,[(0,n.createVNode)(c.ZP,{layout:"inline",rules:a,ref:t,model:o,hideRequiredMark:!0},{default:()=>[(0,n.createVNode)(c.ZP.Item,{label:"组件名称",name:"name"},{default:()=>[(0,n.createVNode)(m.ZP,{value:o.name,"onUpdate:value":e=>o.name=e},null)]}),(0,n.createVNode)(c.ZP.Item,{label:"组件key",name:"key"},{default:()=>[(0,n.createVNode)(m.ZP,{value:o.key,"onUpdate:value":e=>o.key=e,disabled:!!o.id},null)]}),(0,n.createVNode)(c.ZP.Item,null,{default:()=>[(0,n.createVNode)(s.Z,{type:"primary",ghost:!0,onClick:()=>i.value=!0},{default:()=>[(0,n.createTextVNode)("属性定义")]})]})]})]),x=()=>(0,n.createVNode)(s.Z,{type:"primary",onClick:f},{default:()=>[(0,n.createTextVNode)("保存")]});return(0,n.onMounted)((()=>{e.params.id&&(b.log(e.params.id),(0,V.getComponet)(e.params.id).then((e=>{e&&(o.name=e.name,o.key=e.key,o.code=e.code)})))})),{formState:o,extensions:d,iframeRef:r,onPreview:l,Button:s.Z,PageContainer:y.PageContainer,content:N,visible:i,extractContent:x}}},x=o(40089);const Z=(0,x.Z)(N,[["render",d]]);var P=Z}}]);
//# sourceMappingURL=component-editor.56d3e48a.js.map