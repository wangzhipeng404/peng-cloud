{"version":3,"file":"js/478.f86ebf74.js","mappings":"iQAEOA,eAAeC,EAAQC,GAC1B,MAAMC,QAAcC,EAAAA,GAAAA,KAAAA,MAAc,OAAOC,iBAAiBH,EAAOI,KAAKH,QACtE,IAAKD,EAAOK,IAAMJ,EAAQ,EACtB,KAAM,aAEV,MAAMK,EAAU,IACTN,EACHO,WAAYP,EAAOO,aAAc,IAAIC,MAAOC,UAC5CC,YAAY,IAAIF,MAAOC,WAE3BE,EAAQC,IAAIZ,GACZ,MAAMK,QAAWH,EAAAA,GAAAA,KAAAA,IAAYI,EAASA,EAAQD,IAC9C,OAAOA,CACV,CAEMP,eAAee,IAClB,MAAMC,QAAaZ,EAAAA,GAAAA,KAAAA,UAAkBa,OAAO,cAC5C,OAAOD,CACV,CACMhB,eAAekB,EAAQZ,GAC1B,MAAMa,QAAaf,EAAAA,GAAAA,KAAAA,KAAaE,GAEhC,OADAO,EAAQC,IAAIK,GACLA,CACV,CAEMnB,eAAeoB,EAAWd,SACvBF,EAAAA,GAAAA,KAAAA,UAAeE,EACxB,C,2HC3BM,MAAMe,EAAc,CACzB,CACEC,KAAM,IACNC,KAAM,MACNjB,IAAK,MACLkB,KAAM,GACNC,KAAM,gBACNhB,WAAY,cACZG,WAAY,gBAIT,SAASc,IACd,OAAO,IAAIC,SAASC,KAClBb,EAAAA,EAAAA,MAAWc,MAAKb,IACd,MAAMc,EAAU,IAAIT,KAAgBL,GAC9Be,EAAU,CAAC,EACjBD,EAAQE,SAAQb,IACd,GAAIA,EAAIM,KACNM,EAAQZ,EAAIb,KAAOa,EAAIM,SAClB,CACL,MAAMQ,EAAO,IAAIC,KAAK,CAACf,EAAIK,MAAO,CAAEF,KAAM,oBACpCa,EAAUC,IAAIC,gBAAgBJ,GACpCF,EAAQZ,EAAIb,KAAO6B,CACpB,KAEH,MAAMG,EAAQC,SAASC,cAAc,UACrCF,EAAMG,aAAa,OAAQ,aAC3BH,EAAMI,YAAcC,KAAKC,UAAU,CAAEb,UAASc,OAAQ,CAAC,IACvDN,SAASO,qBAAqB,QAAQ,GAAGC,QAAQT,GACjDU,OAAOC,aAAe,KACpBrB,GAAS,EAEX,MAAMsB,EAAUX,SAASC,cAAc,UACvCU,EAAQ5B,KAAO,SACf4B,EAAQR,YAAe,4FACvBJ,EAAMa,MAAMD,EAAZ,GAtBF,GA0BH,C","sources":["webpack://online-conplier/./src/service/lib.js","webpack://online-conplier/./src/utils/importmap.js"],"sourcesContent":["import { db } from './db'\r\n\r\nexport async function saveLib(libObj) {\r\n    const count = await db.libs.where('key').equalsIgnoreCase(libObj.key).count()\r\n    if (!libObj.id && count > 0) {\r\n        throw 'key已存在，请修改'\r\n    }\r\n    const newData = { \r\n        ...libObj,\r\n        createTime: libObj.createTime || new Date().getTime(),\r\n        updateTime: new Date().getTime()\r\n    }\r\n    console.log(libObj)\r\n    const id = await db.libs.put(newData, newData.id)\r\n    return id\r\n}\r\n\r\nexport async function findLibs () {\r\n    const list = await db.libs.reverse().sortBy('updateTime')\r\n    return list\r\n}\r\nexport async function getLib (key) {\r\n    const lib =  await db.libs.get(+key)\r\n    console.log(lib)\r\n    return lib\r\n}\r\n\r\nexport async function deleteLib (key) {\r\n    await db.libs.delete(key)\r\n}","import { findLibs } from '../service/lib'\r\n\r\nexport const defaultLibs = [\r\n  {\r\n    type: '1',\r\n    name: 'vue',\r\n    key: 'vue',\r\n    code: '',\r\n    path: './esm/vue.mjs',\r\n    createTime: 1661078329130,\r\n    updateTime: 1661078329130,\r\n  }\r\n]\r\n\r\nexport function initImportMap() {\r\n  return new Promise((resovle) => {\r\n    findLibs().then(list => {\r\n      const newList = [...defaultLibs, ...list]\r\n      const imports = {}\r\n      newList.forEach(lib => {\r\n        if (lib.path) {\r\n          imports[lib.key] = lib.path\r\n        } else {\r\n          const blob = new Blob([lib.code], { type: 'text/javascript' });\r\n          const blobURL = URL.createObjectURL(blob);\r\n          imports[lib.key] = blobURL\r\n        }\r\n      })\r\n      const mapEl = document.createElement('script');\r\n      mapEl.setAttribute('type', 'importmap');\r\n      mapEl.textContent = JSON.stringify({ imports, scopes: {} });\r\n      document.getElementsByTagName('head')[0].prepend(mapEl)\r\n      window.moduleLoaded = () => {\r\n        resovle()\r\n      }\r\n      const $script = document.createElement('script')\r\n      $script.type = 'module'\r\n      $script.textContent = `import * as vue from 'vue';window.Vue=vue;window.moduleLoaded();window.moduleLoaded=null;`\r\n      mapEl.after($script)\r\n    })\r\n  })\r\n\r\n}\r\n"],"names":["async","saveLib","libObj","count","db","equalsIgnoreCase","key","id","newData","createTime","Date","getTime","updateTime","console","log","findLibs","list","sortBy","getLib","lib","deleteLib","defaultLibs","type","name","code","path","initImportMap","Promise","resovle","then","newList","imports","forEach","blob","Blob","blobURL","URL","createObjectURL","mapEl","document","createElement","setAttribute","textContent","JSON","stringify","scopes","getElementsByTagName","prepend","window","moduleLoaded","$script","after"],"sourceRoot":""}