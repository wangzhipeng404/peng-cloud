"use strict";(self["webpackChunkonline_conplier"]=self["webpackChunkonline_conplier"]||[]).push([[443],{81951:function(e,t,a){a.r(t),a.d(t,{default:function(){return M}});var o=a(10311);const n={class:"container"},r={class:"editor-wrap"},i={class:"preview-container"},l={class:"preview-wrap"},d=["src"],s={class:"preview-wrap"},c=(0,o.createElementVNode)("p",null,"todo",-1);function m(e,t,a,m,u,p){const v=(0,o.resolveComponent)("codemirror"),f=(0,o.resolveComponent)("TabPane"),y=(0,o.resolveComponent)("Tabs"),w=(0,o.resolveComponent)("Drawer"),h=(0,o.resolveComponent)("PageContainer");return(0,o.openBlock)(),(0,o.createBlock)(h,{content:m.content},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",n,[(0,o.createElementVNode)("div",r,[(0,o.createVNode)(v,{modelValue:m.formState.code,"onUpdate:modelValue":t[0]||(t[0]=e=>m.formState.code=e),placeholder:"Code goes here...",style:(0,o.normalizeStyle)({height:"calc(100vh - 200px)"}),autofocus:!0,"indent-with-tab":!0,"tab-size":2,extensions:m.extensions},null,8,["modelValue","style","extensions"])]),(0,o.createElementVNode)("div",i,[(0,o.createVNode)(y,{centered:""},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(f,{key:"1",tab:"预览"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",l,[(0,o.createElementVNode)("iframe",{src:m.iframeSrc,frameborder:"0",style:{height:"100%",width:"100%"},id:"preview-iframe",sandbox:"allow-same-origin allow-forms allow-scripts allow-top-navigation-to-custom-protocols allow-top-navigation-by-user-activation allow-top-navigation"},null,8,d)])])),_:1}),(0,o.createVNode)(f,{key:"2",tab:"编译结果"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",s,[(0,o.createVNode)(v,{modelValue:m.parsedCode,"onUpdate:modelValue":t[1]||(t[1]=e=>m.parsedCode=e),placeholder:"Code goes here...",style:{height:"100%"},autofocus:!0,"indent-with-tab":!0,"tab-size":2,extensions:m.extensions,disabled:""},null,8,["modelValue","extensions"])])])),_:1})])),_:1})])]),(0,o.createVNode)(w,{visible:m.visible,"onUpdate:visible":t[2]||(t[2]=e=>m.visible=e),title:"属性定义",placement:"right"},{default:(0,o.withCtx)((()=>[c])),_:1},8,["visible"])])),_:1},8,["content"])}a(24535);var u=a(74246),p=(a(6566),a(99332)),v=(a(24348),a(68626)),f=(a(1350),a(10252)),y=(a(45164),a(2162)),w=(a(4802),a(243)),h=a(22483),V=a(28934),g=a(56159),b=a(23011),C=a(5406),k=a(71901),N=a(24887);const x="\n<template>\n  <div class=\"blue\">{{date}}</div>\n  <div>{{msg}}</div>\n</template>\n<script setup>\n  import { ref } from 'vue'\n  import dayjs from 'https://unpkg.com/dayjs@1.11.5/esm/index.js'\n  const date = dayjs().format('YYYY-MM-DD HH:mm:ss')\n  const msg = ref('编辑完成后，Ctrl + s 即可预览')\n<\/script>\n<style lang=\"styl\" scoped>\n.blue\n  color blue\n</style>\n";var P=a(29583),Z=a(15941),E={name:"x-editor",components:{Codemirror:g.Z1,Drawer:w.Z,Tabs:y.Z,TabPane:y.Z.TabPane,PageContainer:V.PageContainer},setup(){const e=(0,h.yj)(),t=(0,o.ref)(null),a=(0,o.reactive)({id:+e.params.id,name:"",key:"",code:x}),n=(0,o.reactive)({name:[{required:!0,message:"请输入组件名称"}],key:[{required:!0,message:"请输入组件key"}],code:[{required:!0,message:"请输入代码"}]}),r=(0,o.ref)(`${location.origin}${location.pathname}#/preview`),i=(0,o.ref)(""),l=(0,o.ref)(!1),d=(0,o.ref)(""),s=async()=>{try{const{minify:e,raw:t}=await(0,N.parser)(a.code);d.value=t,i.value.contentWindow.postMessage({type:"editore2preview",data:e},"*")}catch(e){Z.log(e)}},c=[(0,b.eJ)(),C.vk,k.$f.of([{key:"Ctrl-s",run(){return s(),!0}}])],m=e=>{const{data:{type:t,key:a}}=e;"preview2editor"==t&&(Z.log(t,a),"mounted"===a&&i.value&&s())};(0,o.onMounted)((()=>{window.addEventListener("message",m),i.value=document.getElementById("preview-iframe"),i.value.onload=function(){s()}}));const y=async()=>{if(await t.value.validate(),!a.code)return void f.ZP.error({content:"请输入组件代码",duration:3});let e="";try{const{minify:t}=await(0,N.parser)(a.code);e=t}catch(n){return Z.error(n),void f.ZP.error({content:"编译出错啦，请预览成功再保存",duration:3})}const o={type:"2",name:a.name,key:a.key,code:a.code,script:e};a.id&&(o.id=+a.id);try{const e=await(0,P.saveComponent)(o);a.id=e}catch(n){return Z.error(n),void f.ZP.error({content:n})}f.ZP.success({content:"保存成功",duration:3})},w=()=>(0,o.createVNode)(o.Fragment,null,[(0,o.createVNode)(p.ZP,{layout:"inline",rules:n,ref:t,model:a,hideRequiredMark:!0},{default:()=>[(0,o.createVNode)(p.ZP.Item,{label:"组件名称",name:"name"},{default:()=>[(0,o.createVNode)(v.ZP,{value:a.name,"onUpdate:value":e=>a.name=e},null)]}),(0,o.createVNode)(p.ZP.Item,{label:"组件key",name:"key"},{default:()=>[(0,o.createVNode)(v.ZP,{value:a.key,"onUpdate:value":e=>a.key=e,disabled:!!a.id},null)]}),(0,o.createVNode)(p.ZP.Item,null,{default:()=>[(0,o.createVNode)(u.Z,{type:"primary",ghost:!0,onClick:()=>l.value=!0},{default:()=>[(0,o.createTextVNode)("属性定义")]})]}),(0,o.createVNode)(p.ZP.Item,null,{default:()=>[(0,o.createVNode)(u.Z,{type:"primary",onClick:y},{default:()=>[(0,o.createTextVNode)("保存")]})]})]})]);return(0,o.onMounted)((()=>{e.params.id&&(Z.log(e.params.id),(0,P.getComponet)(e.params.id).then((e=>{e&&(a.name=e.name,a.key=e.key,a.code=e.code)})))})),{formState:a,extensions:c,iframeRef:i,onPreview:s,content:w,visible:l,iframeSrc:r,parsedCode:d}}},T=a(40089);const _=(0,T.Z)(E,[["render",m]]);var M=_}}]);