"use strict";(self["webpackChunkonline_conplier"]=self["webpackChunkonline_conplier"]||[]).push([[443],{23016:function(e,t,o){o.r(t),o.d(t,{default:function(){return M}});var n=o(10311);const a={class:"container"},r={class:"editor-wrap"},i={class:"preview-container"},l={class:"preview-wrap"},d=["src"],c=(0,n.createElementVNode)("p",null,"todo",-1);function s(e,t,o,s,m,u){const p=(0,n.resolveComponent)("codemirror"),v=(0,n.resolveComponent)("Drawer"),f=(0,n.resolveComponent)("PageContainer");return(0,n.openBlock)(),(0,n.createBlock)(f,{content:s.content,extraContent:s.extractContent},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",a,[(0,n.createElementVNode)("div",r,[(0,n.createVNode)(p,{modelValue:s.formState.code,"onUpdate:modelValue":t[0]||(t[0]=e=>s.formState.code=e),placeholder:"Code goes here...",style:(0,n.normalizeStyle)({height:"calc(100vh - 200px)"}),autofocus:!0,"indent-with-tab":!0,"tab-size":2,extensions:s.extensions},null,8,["modelValue","style","extensions"])]),(0,n.createElementVNode)("div",i,[(0,n.createElementVNode)("div",l,[(0,n.createElementVNode)("iframe",{src:s.iframeSrc,frameborder:"0",style:{height:"70vh",width:"100%"},id:"preview-iframe",sandbox:"allow-same-origin allow-forms allow-scripts allow-top-navigation-to-custom-protocols allow-top-navigation-by-user-activation allow-top-navigation"},null,8,d)])])]),(0,n.createVNode)(v,{visible:s.visible,"onUpdate:visible":t[1]||(t[1]=e=>s.visible=e),title:"属性定义",placement:"right"},{default:(0,n.withCtx)((()=>[c])),_:1},8,["visible"])])),_:1},8,["content","extraContent"])}o(24535);var m=o(74246),u=(o(6566),o(99332)),p=(o(24348),o(68626)),v=(o(1350),o(10252)),f=(o(4802),o(243)),y=o(22483),w=o(28934),g=o(56159),h=o(23011),k=o(5406),C=o(71901),V=o(24887);const b="\n<template>\n  <div class=\"blue\">{{date}}</div>\n  <div>{{msg}}</div>\n</template>\n<script setup>\n  import { ref } from 'vue'\n  import dayjs from 'https://unpkg.com/dayjs@1.11.5/esm/index.js'\n  const date = dayjs().format('YYYY-MM-DD HH:mm:ss')\n  const msg = ref('编辑完成后，Ctrl + s 即可预览')\n<\/script>\n<style lang=\"styl\" scoped>\n.blue\n  color blue\n</style>\n";var N=o(29583),x=o(15941),Z={name:"x-editor",components:{Codemirror:g.Z1,Drawer:f.Z},setup(){const e=(0,y.yj)(),t=(0,n.ref)(null),o=(0,n.reactive)({id:+e.params.id,name:"",key:"",code:b}),a=(0,n.reactive)({name:[{required:!0,message:"请输入组件名称"}],key:[{required:!0,message:"请输入组件key"}],code:[{required:!0,message:"请输入代码"}]}),r=(0,n.ref)(`${location.origin}${location.pathname}#/preview`),i=(0,n.ref)(""),l=(0,n.ref)(!1),d=async()=>{try{const e=await(0,V.parser)(o.code);i.value.contentWindow.postMessage({type:"editore2preview",data:e},"*")}catch(e){x.log(e)}},c=[(0,h.eJ)(),k.vk,C.$f.of([{key:"Ctrl-s",run(){return d(),!0}}])],s=e=>{const{data:{type:t,key:o}}=e;"preview2editor"==t&&(x.log(t,o),"mounted"===o&&i.value&&d())};(0,n.onMounted)((()=>{window.addEventListener("message",s),i.value=document.getElementById("preview-iframe"),i.value.onload=function(){d()}}));const f=async()=>{if(await t.value.validate(),!o.code)return void v.ZP.error({content:"请输入组件代码",duration:3});let e={};try{e=await(0,V.parser)(o.code)}catch(a){return x.error(a),void v.ZP.error({content:"编译出错啦，请预览成功再保存",duration:3})}const n={type:"2",name:o.name,key:o.key,code:o.code,script:e};o.id&&(n.id=+o.id);try{const e=await(0,N.saveComponent)(n);o.id=e}catch(a){return x.error(a),void v.ZP.error({content:a})}v.ZP.success({content:"保存成功",duration:3})},g=()=>(0,n.createVNode)(n.Fragment,null,[(0,n.createVNode)(u.ZP,{layout:"inline",rules:a,ref:t,model:o,hideRequiredMark:!0},{default:()=>[(0,n.createVNode)(u.ZP.Item,{label:"组件名称",name:"name"},{default:()=>[(0,n.createVNode)(p.ZP,{value:o.name,"onUpdate:value":e=>o.name=e},null)]}),(0,n.createVNode)(u.ZP.Item,{label:"组件key",name:"key"},{default:()=>[(0,n.createVNode)(p.ZP,{value:o.key,"onUpdate:value":e=>o.key=e,disabled:!!o.id},null)]}),(0,n.createVNode)(u.ZP.Item,null,{default:()=>[(0,n.createVNode)(m.Z,{type:"primary",ghost:!0,onClick:()=>l.value=!0},{default:()=>[(0,n.createTextVNode)("属性定义")]})]})]})]),Z=()=>(0,n.createVNode)(m.Z,{type:"primary",onClick:f},{default:()=>[(0,n.createTextVNode)("保存")]});return(0,n.onMounted)((()=>{e.params.id&&(x.log(e.params.id),(0,N.getComponet)(e.params.id).then((e=>{e&&(o.name=e.name,o.key=e.key,o.code=e.code)})))})),{formState:o,extensions:c,iframeRef:i,onPreview:d,Button:m.Z,PageContainer:w.PageContainer,content:g,visible:l,extractContent:Z,iframeSrc:r}}},P=o(40089);const E=(0,P.Z)(Z,[["render",s]]);var M=E}}]);